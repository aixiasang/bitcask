# ğŸ”§ å‘½ä»¤è¡Œå·¥å…·

Bitcask çš„å‘½ä»¤è¡Œå·¥å…·æ¨¡å—ï¼Œæä¾›äº†ä¸°å¯Œçš„å‘½ä»¤è¡Œæ¥å£ç”¨äºç®¡ç†å’Œæ“ä½œ Bitcask å­˜å‚¨å¼•æ“ã€‚

## ğŸŒŸ åŠŸèƒ½æ¦‚è¿°

æœ¬æ¨¡å—åŸºäº [spf13/cobra](https://github.com/spf13/cobra) æ„å»ºï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

- ğŸ–¥ï¸ æœåŠ¡å¯åŠ¨ä¸ç®¡ç†
- ğŸ—„ï¸ æ•°æ®æ“ä½œä¸ç»´æŠ¤
- ğŸŒ é›†ç¾¤ç®¡ç†
- ğŸ§° å®ç”¨å·¥å…·

## ğŸ“Š å‘½ä»¤ç»“æ„

```
bitcask
â”œâ”€â”€ server      - å¯åŠ¨å„ç§æœåŠ¡å™¨
â”‚   â”œâ”€â”€ redis   - å¯åŠ¨ Redis å…¼å®¹æœåŠ¡å™¨
â”‚   â”œâ”€â”€ http    - å¯åŠ¨ HTTP API æœåŠ¡å™¨
â”‚   â””â”€â”€ raft    - å¯åŠ¨ Raft åˆ†å¸ƒå¼èŠ‚ç‚¹
â”œâ”€â”€ get         - è·å–é”®å€¼
â”œâ”€â”€ set         - è®¾ç½®é”®å€¼
â”œâ”€â”€ del         - åˆ é™¤é”®å€¼
â”œâ”€â”€ keys        - åˆ—å‡ºæ‰€æœ‰é”®
â”œâ”€â”€ ttl         - æŸ¥çœ‹é”®çš„å‰©ä½™è¿‡æœŸæ—¶é—´
â”œâ”€â”€ expire      - è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´
â”œâ”€â”€ hint        - ç”Ÿæˆ hint æ–‡ä»¶
â”œâ”€â”€ merge       - æ‰§è¡Œæ•°æ®æ–‡ä»¶åˆå¹¶
â”œâ”€â”€ backup      - å¤‡ä»½æ•°æ®
â”œâ”€â”€ restore     - æ¢å¤æ•°æ®
â”œâ”€â”€ benchmark   - æ€§èƒ½åŸºå‡†æµ‹è¯•
â””â”€â”€ admin       - ç®¡ç†åŠŸèƒ½
    â”œâ”€â”€ stats   - æŸ¥çœ‹å­˜å‚¨ç»Ÿè®¡ä¿¡æ¯
    â””â”€â”€ compact - å‹ç¼©æ•°æ®æ–‡ä»¶
```

## ğŸš€ ä¸»è¦å‘½ä»¤è¯¦è§£

### ğŸ–¥ï¸ æœåŠ¡å™¨å‘½ä»¤

#### ğŸ”„ Redis æœåŠ¡å™¨

å¯åŠ¨ Redis å…¼å®¹æœåŠ¡å™¨ï¼š

```bash
bitcask server redis --addr :6379 --data-dir ./data
```

é€‰é¡¹ï¼š
- `--addr` - æœåŠ¡ç›‘å¬åœ°å€ï¼Œé»˜è®¤ `:6379`
- `--data-dir` - æ•°æ®å­˜å‚¨ç›®å½•
- `--password` - å¯é€‰çš„è®¤è¯å¯†ç 

#### ğŸŒ HTTP æœåŠ¡å™¨

å¯åŠ¨ HTTP API æœåŠ¡å™¨ï¼š

```bash
bitcask server http --addr :8080 --data-dir ./data
```

é€‰é¡¹ï¼š
- `--addr` - æœåŠ¡ç›‘å¬åœ°å€ï¼Œé»˜è®¤ `:8080`
- `--data-dir` - æ•°æ®å­˜å‚¨ç›®å½•
- `--cors` - æ˜¯å¦å¯ç”¨è·¨åŸŸè¯·æ±‚æ”¯æŒ

#### ğŸ”„ Raft æœåŠ¡å™¨

å¯åŠ¨ Raft åˆ†å¸ƒå¼èŠ‚ç‚¹ï¼š

```bash
bitcask server raft --id 1 --addr :9001 --peers "2=:9002,3=:9003" --data-dir ./raft-node1
```

é€‰é¡¹ï¼š
- `--id` - èŠ‚ç‚¹ ID
- `--addr` - èŠ‚ç‚¹åœ°å€
- `--peers` - é›†ç¾¤å…¶ä»–èŠ‚ç‚¹åœ°å€
- `--data-dir` - æ•°æ®å­˜å‚¨ç›®å½•
- `--join` - æ˜¯å¦ä»¥åŠ å…¥æ¨¡å¼å¯åŠ¨

### ğŸ—„ï¸ æ•°æ®æ“ä½œå‘½ä»¤

#### â¬†ï¸ è®¾ç½®é”®å€¼

```bash
bitcask set mykey "Hello World" --ttl 3600
```

é€‰é¡¹ï¼š
- `--ttl` - è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

#### â¬‡ï¸ è·å–é”®å€¼

```bash
bitcask get mykey
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

#### ğŸ—‘ï¸ åˆ é™¤é”®å€¼

```bash
bitcask del mykey
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

#### ğŸ“‹ åˆ—å‡ºæ‰€æœ‰é”®

```bash
bitcask keys
```

é€‰é¡¹ï¼š
- `--pattern` - åŒ¹é…æ¨¡å¼ï¼ˆæ”¯æŒé€šé…ç¬¦ï¼‰
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

#### â±ï¸ è®¾ç½®è¿‡æœŸæ—¶é—´

```bash
bitcask expire mykey 3600
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

### ğŸ§¹ æ•°æ®ç»´æŠ¤å‘½ä»¤

#### ğŸ“ ç”Ÿæˆ Hint æ–‡ä»¶

```bash
bitcask hint --data-dir ./data
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„

#### ğŸ”„ åˆå¹¶æ•°æ®æ–‡ä»¶

```bash
bitcask merge --data-dir ./data
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„
- `--threshold` - è§¦å‘åˆå¹¶çš„æ–‡ä»¶æ•°é˜ˆå€¼

#### ğŸ’¾ å¤‡ä»½æ•°æ®

```bash
bitcask backup --data-dir ./data --target ./backup.tar.gz
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„
- `--target` - å¤‡ä»½æ–‡ä»¶è·¯å¾„

#### ğŸ“¥ æ¢å¤æ•°æ®

```bash
bitcask restore --source ./backup.tar.gz --target ./restored-data
```

é€‰é¡¹ï¼š
- `--source` - å¤‡ä»½æ–‡ä»¶è·¯å¾„
- `--target` - æ¢å¤ç›®æ ‡ç›®å½•

### ğŸ“Š æ€§èƒ½æµ‹è¯•å‘½ä»¤

```bash
bitcask benchmark --ops 100000 --value-size 1024 --threads 4
```

é€‰é¡¹ï¼š
- `--ops` - æ“ä½œæ¬¡æ•°
- `--value-size` - å€¼å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- `--threads` - çº¿ç¨‹æ•°
- `--read-write-ratio` - è¯»å†™æ¯”ä¾‹

### âš™ï¸ ç®¡ç†å‘½ä»¤

#### ğŸ“ˆ æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```bash
bitcask admin stats --data-dir ./data
```

è¾“å‡ºåŒ…æ‹¬ï¼š
- é”®æ•°é‡
- ç£ç›˜å ç”¨
- æ•°æ®æ–‡ä»¶æ•°é‡
- å†…å­˜å ç”¨

#### ğŸ—œï¸ å‹ç¼©æ•°æ®æ–‡ä»¶

```bash
bitcask admin compact --data-dir ./data
```

é€‰é¡¹ï¼š
- `--data-dir` - æ•°æ®ç›®å½•è·¯å¾„
- `--force` - å¼ºåˆ¶æ‰§è¡Œï¼Œå¿½ç•¥æ–‡ä»¶æ•°é˜ˆå€¼

## ğŸŒ å…¨å±€é€‰é¡¹

æ‰€æœ‰å‘½ä»¤æ”¯æŒä»¥ä¸‹å…¨å±€é€‰é¡¹ï¼š

- `--config` - é…ç½®æ–‡ä»¶è·¯å¾„
- `--verbose` - å¯ç”¨è¯¦ç»†æ—¥å¿—
- `--log-level` - æ—¥å¿—çº§åˆ«ï¼ˆdebug, info, warn, errorï¼‰
- `--log-file` - æ—¥å¿—æ–‡ä»¶è·¯å¾„

## âš™ï¸ é…ç½®æ–‡ä»¶

å¯ä»¥é€šè¿‡ YAML æ–‡ä»¶æä¾›é…ç½®ï¼Œä¾‹å¦‚ï¼š

```yaml
# bitcask.yaml
data-dir: /var/lib/bitcask
log-level: info
log-file: /var/log/bitcask.log

server:
  redis:
    addr: :6379
    password: ""
  
  http:
    addr: :8080
    cors: true
```

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### ğŸš€ å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®æ•°æ®

```bash
# å¯åŠ¨ Redis æœåŠ¡
bitcask server redis --data-dir ./data &

# è®¾ç½®ä¸€äº›æµ‹è¯•æ•°æ®
bitcask set user:1 '{"name":"John","age":30}' --ttl 3600
bitcask set user:2 '{"name":"Alice","age":25}' --ttl 3600

# è·å–æ•°æ®
bitcask get user:1

# åˆ—å‡ºæ‰€æœ‰é”®
bitcask keys --pattern "user:*"
```

### ğŸ§¹ æ•°æ®ç»´æŠ¤

```bash
# åˆå¹¶æ•°æ®æ–‡ä»¶
bitcask merge --data-dir ./data

# å¤‡ä»½æ•°æ®
bitcask backup --data-dir ./data --target ./backup.tar.gz

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
bitcask admin stats --data-dir ./data
``` 